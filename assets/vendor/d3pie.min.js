/*!
 * d3pie
 * @author Ben Keen
 * @version 0.1.9
 * @date June 17th, 2015
 * @repo http://github.com/benkeen/d3pie
 */
!function(root,factory){"function"==typeof define&&define.amd?define([],factory):"object"==typeof exports?module.exports=factory():root.d3pie=factory(root)}(this,(function(){var _scriptName="d3pie",_version="0.2.1",_uniqueIDCounter=0,defaultSettings={header:{title:{text:"",color:"#333333",fontSize:18,font:"arial"},subtitle:{text:"",color:"#666666",fontSize:14,font:"arial"},location:"top-center",titleSubtitlePadding:8},footer:{text:"",color:"#666666",fontSize:14,font:"arial",location:"left"},size:{canvasHeight:500,canvasWidth:500,pieInnerRadius:"0%",pieOuterRadius:null},data:{sortOrder:"none",ignoreSmallSegments:{enabled:!1,valueType:"percentage",value:null},smallSegmentGrouping:{enabled:!1,value:1,valueType:"percentage",label:"Other",color:"#cccccc"},content:[]},labels:{outer:{format:"label",hideWhenLessThanPercentage:null,pieDistance:30},inner:{format:"percentage",hideWhenLessThanPercentage:null},mainLabel:{color:"#333333",font:"arial",fontSize:10},percentage:{color:"#dddddd",font:"arial",fontSize:10,decimalPlaces:0},value:{color:"#cccc44",font:"arial",fontSize:10},lines:{enabled:!0,style:"curved",color:"segment"},truncation:{enabled:!1,truncateLength:30},formatter:null},effects:{load:{effect:"default",speed:1e3},pullOutSegmentOnClick:{effect:"bounce",speed:300,size:10},highlightSegmentOnMouseover:!0,highlightLuminosity:-.2},tooltips:{enabled:!1,type:"placeholder",string:"",placeholderParser:null,styles:{fadeInSpeed:250,backgroundColor:"#000000",backgroundOpacity:.5,color:"#efefef",borderRadius:2,font:"arial",fontSize:10,padding:4}},misc:{colors:{background:null,segments:["#2484c1","#65a620","#7b6888","#a05d56","#961a1a","#d8d23a","#e98125","#d0743c","#635222","#6ada6a","#0c6197","#7d9058","#207f33","#44b9b0","#bca44a","#e4a14b","#a3acb2","#8cc3e9","#69a6f9","#5b388f","#546e91","#8bde95","#d2ab58","#273c71","#98bf6e","#4daa4b","#98abc5","#cc1010","#31383b","#006391","#c2643f","#b0a474","#a5a39c","#a9c2bc","#22af8c","#7fcecf","#987ac6","#3d3b87","#b77b1c","#c9c2b6","#807ece","#8db27c","#be66a2","#9ed3c6","#00644b","#005064","#77979f","#77e079","#9c73ab","#1f79a7"],segmentStroke:"#ffffff"},gradient:{enabled:!1,percentage:95,color:"#000000"},canvasPadding:{top:5,right:5,bottom:5,left:5},pieCenterOffset:{x:0,y:0},cssPrefix:null},callbacks:{onload:null,onMouseoverSegment:null,onMouseoutSegment:null,onClickSegment:null}},validate_initialCheck=function(pie){var cssPrefix=pie.cssPrefix,element=pie.element,options=pie.options;if(!window.d3||!window.d3.hasOwnProperty("version"))return console.error("d3pie error: d3 is not available"),!1;if(!(element instanceof HTMLElement||element instanceof SVGElement))return console.error("d3pie error: the first d3pie() param must be a valid DOM element (not jQuery) or a ID string."),!1;if(!/[a-zA-Z][a-zA-Z0-9_-]*$/.test(cssPrefix))return console.error("d3pie error: invalid options.misc.cssPrefix"),!1;if(!helpers.isArray(options.data.content))return console.error("d3pie error: invalid config structure: missing data.content property."),!1;if(0===options.data.content.length)return console.error("d3pie error: no data supplied."),!1;for(var data=[],i=0;i<options.data.content.length;i++)"number"!=typeof options.data.content[i].value||isNaN(options.data.content[i].value)?console.log("not valid: ",options.data.content[i]):options.data.content[i].value<=0?console.log("not valid - should have positive value: ",options.data.content[i]):data.push(options.data.content[i]);return pie.options.data.content=data,!0},helpers={addSVGSpace:function(pie){var element=pie.element,canvasWidth=pie.options.size.canvasWidth,canvasHeight=pie.options.size.canvasHeight,backgroundColor=pie.options.misc.colors.background,svg=d3.select(element).append("svg:svg").attr("width","100%").attr("height","100% ").attr("viewBox","0 0 "+canvasWidth+"  "+canvasHeight);return"transparent"!==backgroundColor&&svg.style("background-color",(function(){return backgroundColor})),svg},whenIdExists:function(id,callback){var inc=1,giveupIterationCount=1e3,interval=setInterval((function(){document.getElementById(id)&&(clearInterval(interval),callback()),inc>1e3&&clearInterval(interval),inc++}),1)},whenElementsExist:function(els,callback){var inc=1,giveupIterationCount=1e3,interval=setInterval((function(){for(var allExist=!0,i=0;i<els.length;i++)if(!document.getElementById(els[i])){allExist=!1;break}allExist&&(clearInterval(interval),callback()),inc>1e3&&clearInterval(interval),inc++}),1)},shuffleArray:function(array){for(var currentIndex=array.length,tmpVal,randomIndex;0!==currentIndex;)randomIndex=Math.floor(Math.random()*currentIndex),tmpVal=array[currentIndex-=1],array[currentIndex]=array[randomIndex],array[randomIndex]=tmpVal;return array},processObj:function(obj,is,value){return"string"==typeof is?helpers.processObj(obj,is.split("."),value):1===is.length&&void 0!==value?(obj[is[0]]=value,obj[is[0]]):0===is.length?obj:helpers.processObj(obj[is[0]],is.slice(1),value)},getDimensions:function(id){var el=document.getElementById(id),w=0,h=0;if(el){var dimensions=el.getBBox();w=dimensions.width,h=dimensions.height}else console.log("error: getDimensions() "+id+" not found.");return{w:w,h:h}},rectIntersect:function(r1,r2){var returnVal;return!(r2.x>r1.x+r1.w||r2.x+r2.w<r1.x||r2.y+r2.h<r1.y||r2.y>r1.y+r1.h)},getColorShade:function(hex,lum){(hex=String(hex).replace(/[^0-9a-f]/gi,"")).length<6&&(hex=hex[0]+hex[0]+hex[1]+hex[1]+hex[2]+hex[2]),lum=lum||0;for(var newHex="#",i=0;i<3;i++){var c=parseInt(hex.substr(2*i,2),16);newHex+=("00"+(c=Math.round(Math.min(Math.max(0,c+c*lum),255)).toString(16))).substr(c.length)}return newHex},initSegmentColors:function(pie){for(var data=pie.options.data.content,colors=pie.options.misc.colors.segments,finalColors=[],i=0;i<data.length;i++)data[i].hasOwnProperty("color")?finalColors.push(data[i].color):finalColors.push(colors[i]);return finalColors},applySmallSegmentGrouping:function(data,smallSegmentGrouping){var totalSize;"percentage"===smallSegmentGrouping.valueType&&(totalSize=math.getTotalPieSize(data));for(var newData=[],groupedData=[],totalGroupedData=0,i=0;i<data.length;i++)if("percentage"===smallSegmentGrouping.valueType){var dataPercent;if(data[i].value/totalSize*100<=smallSegmentGrouping.value){groupedData.push(data[i]),totalGroupedData+=data[i].value;continue}data[i].isGrouped=!1,newData.push(data[i])}else{if(data[i].value<=smallSegmentGrouping.value){groupedData.push(data[i]),totalGroupedData+=data[i].value;continue}data[i].isGrouped=!1,newData.push(data[i])}return groupedData.length&&newData.push({color:smallSegmentGrouping.color,label:smallSegmentGrouping.label,value:totalGroupedData,isGrouped:!0,groupedData:groupedData}),newData},showPoint:function(svg,x,y){svg.append("circle").attr("cx",x).attr("cy",y).attr("r",2).style("fill","black")},isFunction:function(functionToCheck){var getType;return functionToCheck&&"[object Function]"==={}.toString.call(functionToCheck)},isArray:function(o){return"[object Array]"===Object.prototype.toString.call(o)}},extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=!1,toString=Object.prototype.toString,hasOwn=Object.prototype.hasOwnProperty,class2type={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},jQuery={isFunction:function(obj){return"function"===jQuery.type(obj)},isArray:Array.isArray||function(obj){return"array"===jQuery.type(obj)},isWindow:function(obj){return null!==obj&&obj===obj.window},isNumeric:function(obj){return!isNaN(parseFloat(obj))&&isFinite(obj)},type:function(obj){return null===obj?String(obj):class2type[toString.call(obj)]||"object"},isPlainObject:function(obj){if(!obj||"object"!==jQuery.type(obj)||obj.nodeType)return!1;try{if(obj.constructor&&!hasOwn.call(obj,"constructor")&&!hasOwn.call(obj.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}var key;for(key in obj);return void 0===key||hasOwn.call(obj,key)}};for("boolean"==typeof target&&(deep=target,target=arguments[1]||{},i=2),"object"==typeof target||jQuery.isFunction(target)||(target={}),length===i&&(target=this,--i);i<length;i++)if(null!==(options=arguments[i]))for(name in options)src=target[name],target!==(copy=options[name])&&(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))?(copyIsArray?(copyIsArray=!1,clone=src&&jQuery.isArray(src)?src:[]):clone=src&&jQuery.isPlainObject(src)?src:{},target[name]=extend(deep,clone,copy)):void 0!==copy&&(target[name]=copy));return target},math={toRadians:function(degrees){return degrees*(Math.PI/180)},toDegrees:function(radians){return radians*(180/Math.PI)},computePieRadius:function(pie){var size=pie.options.size,canvasPadding=pie.options.misc.canvasPadding,w=size.canvasWidth-canvasPadding.left-canvasPadding.right,h=size.canvasHeight-canvasPadding.top-canvasPadding.bottom;"pie-center"!==pie.options.header.location&&(h-=pie.textComponents.headerHeight),pie.textComponents.footer.exists&&(h-=pie.textComponents.footer.h);var outerRadius=(w<(h=h<0?0:h)?w:h)/3,innerRadius,percent;if(null!==size.pieOuterRadius)if(/%/.test(size.pieOuterRadius)){percent=(percent=(percent=parseInt(size.pieOuterRadius.replace(/[\D]/,""),10))>99?99:percent)<0?0:percent;var smallestDimension=w<h?w:h;if("none"!==pie.options.labels.outer.format){var pieDistanceSpace=2*parseInt(pie.options.labels.outer.pieDistance,10);smallestDimension-pieDistanceSpace>0&&(smallestDimension-=pieDistanceSpace)}outerRadius=Math.floor(smallestDimension/100*percent)/2}else outerRadius=parseInt(size.pieOuterRadius,10);/%/.test(size.pieInnerRadius)?(percent=(percent=(percent=parseInt(size.pieInnerRadius.replace(/[\D]/,""),10))>99?99:percent)<0?0:percent,innerRadius=Math.floor(outerRadius/100*percent)):innerRadius=parseInt(size.pieInnerRadius,10),pie.innerRadius=innerRadius,pie.outerRadius=outerRadius},getTotalPieSize:function(data){for(var totalSize=0,i=0;i<data.length;i++)totalSize+=data[i].value;return totalSize},sortPieData:function(pie){var data=pie.options.data.content,sortOrder;switch(pie.options.data.sortOrder){case"none":break;case"random":data=helpers.shuffleArray(data);break;case"value-asc":data.sort((function(a,b){return a.value<b.value?-1:1}));break;case"value-desc":data.sort((function(a,b){return a.value<b.value?1:-1}));break;case"label-asc":data.sort((function(a,b){return a.label.toLowerCase()>b.label.toLowerCase()?1:-1}));break;case"label-desc":data.sort((function(a,b){return a.label.toLowerCase()<b.label.toLowerCase()?1:-1}))}return data},getPieTranslateCenter:function(pieCenter){return"translate("+pieCenter.x+","+pieCenter.y+")"},calculatePieCenter:function(pie){var pieCenterOffset=pie.options.misc.pieCenterOffset,hasTopTitle=pie.textComponents.title.exists&&"pie-center"!==pie.options.header.location,hasTopSubtitle=pie.textComponents.subtitle.exists&&"pie-center"!==pie.options.header.location,headerOffset=pie.options.misc.canvasPadding.top;hasTopTitle&&hasTopSubtitle?headerOffset+=pie.textComponents.title.h+pie.options.header.titleSubtitlePadding+pie.textComponents.subtitle.h:hasTopTitle?headerOffset+=pie.textComponents.title.h:hasTopSubtitle&&(headerOffset+=pie.textComponents.subtitle.h);var footerOffset=0;pie.textComponents.footer.exists&&(footerOffset=pie.textComponents.footer.h+pie.options.misc.canvasPadding.bottom);var x=(pie.options.size.canvasWidth-pie.options.misc.canvasPadding.left-pie.options.misc.canvasPadding.right)/2+pie.options.misc.canvasPadding.left,y=(pie.options.size.canvasHeight-footerOffset-headerOffset)/2+headerOffset;x+=pieCenterOffset.x,y+=pieCenterOffset.y,pie.pieCenter={x:x,y:y}},rotate:function(x,y,xm,ym,a){a=a*Math.PI/180;var cos=Math.cos,sin=Math.sin,xr,yr;return{x:(x-xm)*cos(a)-(y-ym)*sin(a)+xm,y:(x-xm)*sin(a)+(y-ym)*cos(a)+ym}},translate:function(x,y,d,a){var rads=math.toRadians(a);return{x:x+d*Math.sin(rads),y:y-d*Math.cos(rads)}},pointIsInArc:function(pt,ptData,d3Arc){var r1=d3Arc.innerRadius()(ptData),r2=d3Arc.outerRadius()(ptData),theta1=d3Arc.startAngle()(ptData),theta2=d3Arc.endAngle()(ptData),dist=pt.x*pt.x+pt.y*pt.y,angle=Math.atan2(pt.x,-pt.y);return angle=angle<0?angle+2*Math.PI:angle,r1*r1<=dist&&dist<=r2*r2&&theta1<=angle&&angle<=theta2}},labels={add:function(pie,section,sectionDisplayType){var include=labels.getIncludes(sectionDisplayType),settings=pie.options.labels,outerLabel,labelGroup=pie.svg.insert("g","."+pie.cssPrefix+"labels-"+section).attr("class",pie.cssPrefix+"labels-"+section).selectAll("."+pie.cssPrefix+"labelGroup-"+section).data(pie.options.data.content).enter().append("g").attr("id",(function(d,i){return pie.cssPrefix+"labelGroup"+i+"-"+section})).attr("data-index",(function(d,i){return i})).attr("class",pie.cssPrefix+"labelGroup-"+section).style("opacity",0),formatterContext={section:section,sectionDisplayType:sectionDisplayType};include.mainLabel&&labelGroup.append("text").attr("id",(function(d,i){return pie.cssPrefix+"segmentMainLabel"+i+"-"+section})).attr("class",pie.cssPrefix+"segmentMainLabel-"+section).text((function(d,i){var str=d.label;return settings.formatter?(formatterContext.index=i,formatterContext.part="mainLabel",formatterContext.value=d.value,formatterContext.label=str,str=settings.formatter(formatterContext)):settings.truncation.enabled&&d.label.length>settings.truncation.truncateLength&&(str=d.label.substring(0,settings.truncation.truncateLength)+"..."),str})).style("font-size",settings.mainLabel.fontSize+"px").style("font-family",settings.mainLabel.font).style("fill",settings.mainLabel.color),include.percentage&&labelGroup.append("text").attr("id",(function(d,i){return pie.cssPrefix+"segmentPercentage"+i+"-"+section})).attr("class",pie.cssPrefix+"segmentPercentage-"+section).text((function(d,i){var percentage=d.percentage;return settings.formatter?(formatterContext.index=i,formatterContext.part="percentage",formatterContext.value=d.value,formatterContext.label=d.percentage,percentage=settings.formatter(formatterContext)):percentage+="%",percentage})).style("font-size",settings.percentage.fontSize+"px").style("font-family",settings.percentage.font).style("fill",settings.percentage.color),include.value&&labelGroup.append("text").attr("id",(function(d,i){return pie.cssPrefix+"segmentValue"+i+"-"+section})).attr("class",pie.cssPrefix+"segmentValue-"+section).text((function(d,i){return formatterContext.index=i,formatterContext.part="value",formatterContext.value=d.value,formatterContext.label=d.value,settings.formatter?settings.formatter(formatterContext,d.value):d.value})).style("font-size",settings.value.fontSize+"px").style("font-family",settings.value.font).style("fill",settings.value.color)},positionLabelElements:function(pie,section,sectionDisplayType){var labelGroups;labels["dimensions-"+section]=[],d3.selectAll("."+pie.cssPrefix+"labelGroup-"+section).each((function(d,i){var mainLabel=d3.select(this).selectAll("."+pie.cssPrefix+"segmentMainLabel-"+section),percentage=d3.select(this).selectAll("."+pie.cssPrefix+"segmentPercentage-"+section),value=d3.select(this).selectAll("."+pie.cssPrefix+"segmentValue-"+section);labels["dimensions-"+section].push({mainLabel:null!==mainLabel.node()?mainLabel.node().getBBox():null,percentage:null!==percentage.node()?percentage.node().getBBox():null,value:null!==value.node()?value.node().getBBox():null})}));var singleLinePad=5,dims=labels["dimensions-"+section];switch(sectionDisplayType){case"label-value1":d3.selectAll("."+pie.cssPrefix+"segmentValue-"+section).attr("dx",(function(d,i){return dims[i].mainLabel.width+5}));break;case"label-value2":d3.selectAll("."+pie.cssPrefix+"segmentValue-"+section).attr("dy",(function(d,i){return dims[i].mainLabel.height}));break;case"label-percentage1":d3.selectAll("."+pie.cssPrefix+"segmentPercentage-"+section).attr("dx",(function(d,i){return dims[i].mainLabel.width+5}));break;case"label-percentage2":d3.selectAll("."+pie.cssPrefix+"segmentPercentage-"+section).attr("dx",(function(d,i){return dims[i].mainLabel.width/2-dims[i].percentage.width/2})).attr("dy",(function(d,i){return dims[i].mainLabel.height}))}},computeLabelLinePositions:function(pie){pie.lineCoordGroups=[],d3.selectAll("."+pie.cssPrefix+"labelGroup-outer").each((function(d,i){return labels.computeLinePosition(pie,i)}))},computeLinePosition:function(pie,i){var angle=segments.getSegmentAngle(i,pie.options.data.content,pie.totalSize,{midpoint:!0}),originCoords=math.rotate(pie.pieCenter.x,pie.pieCenter.y-pie.outerRadius,pie.pieCenter.x,pie.pieCenter.y,angle),heightOffset=pie.outerLabelGroupData[i].h/5,labelXMargin=6,quarter=Math.floor(angle/90),midPoint=4,x2,y2,x3,y3;switch(2===quarter&&180===angle&&(quarter=1),quarter){case 0:x2=pie.outerLabelGroupData[i].x-6-(pie.outerLabelGroupData[i].x-6-originCoords.x)/2,y2=pie.outerLabelGroupData[i].y+(originCoords.y-pie.outerLabelGroupData[i].y)/4,x3=pie.outerLabelGroupData[i].x-6,y3=pie.outerLabelGroupData[i].y-heightOffset;break;case 1:x2=originCoords.x+(pie.outerLabelGroupData[i].x-originCoords.x)/4,y2=originCoords.y+(pie.outerLabelGroupData[i].y-originCoords.y)/4,x3=pie.outerLabelGroupData[i].x-6,y3=pie.outerLabelGroupData[i].y-heightOffset;break;case 2:var startOfLabelX=pie.outerLabelGroupData[i].x+pie.outerLabelGroupData[i].w+6;x2=originCoords.x-(originCoords.x-startOfLabelX)/4,y2=originCoords.y+(pie.outerLabelGroupData[i].y-originCoords.y)/4,x3=pie.outerLabelGroupData[i].x+pie.outerLabelGroupData[i].w+6,y3=pie.outerLabelGroupData[i].y-heightOffset;break;case 3:var startOfLabel=pie.outerLabelGroupData[i].x+pie.outerLabelGroupData[i].w+6;x2=startOfLabel+(originCoords.x-startOfLabel)/4,y2=pie.outerLabelGroupData[i].y+(originCoords.y-pie.outerLabelGroupData[i].y)/4,x3=pie.outerLabelGroupData[i].x+pie.outerLabelGroupData[i].w+6,y3=pie.outerLabelGroupData[i].y-heightOffset}"straight"===pie.options.labels.lines.style?pie.lineCoordGroups[i]=[{x:originCoords.x,y:originCoords.y},{x:x3,y:y3}]:pie.lineCoordGroups[i]=[{x:originCoords.x,y:originCoords.y},{x:x2,y:y2},{x:x3,y:y3}]},addLabelLines:function(pie){var lineGroups,lineGroup=pie.svg.insert("g","."+pie.cssPrefix+"pieChart").attr("class",pie.cssPrefix+"lineGroups").style("opacity",0).selectAll("."+pie.cssPrefix+"lineGroup").data(pie.lineCoordGroups).enter().append("g").attr("class",pie.cssPrefix+"lineGroup"),lineFunction=d3.line().curve(d3.curveBasis).x((function(d){return d.x})).y((function(d){return d.y}));lineGroup.append("path").attr("d",lineFunction).attr("stroke",(function(d,i){return"segment"===pie.options.labels.lines.color?pie.options.colors[i]:pie.options.labels.lines.color})).attr("stroke-width",1).attr("fill","none").style("opacity",(function(d,i){var percentage=pie.options.labels.outer.hideWhenLessThanPercentage,isHidden;return null!==percentage&&d.percentage<percentage||""===pie.options.data.content[i].label?0:1}))},positionLabelGroups:function(pie,section){"none"!==pie.options.labels[section].format&&d3.selectAll("."+pie.cssPrefix+"labelGroup-"+section).style("opacity",0).attr("transform",(function(d,i){var x,y;if("outer"===section)x=pie.outerLabelGroupData[i].x,y=pie.outerLabelGroupData[i].y;else{var pieCenterCopy=extend(!0,{},pie.pieCenter);if(pie.innerRadius>0){var angle=segments.getSegmentAngle(i,pie.options.data.content,pie.totalSize,{midpoint:!0}),newCoords=math.translate(pie.pieCenter.x,pie.pieCenter.y,pie.innerRadius,angle);pieCenterCopy.x=newCoords.x,pieCenterCopy.y=newCoords.y}var dims=helpers.getDimensions(pie.cssPrefix+"labelGroup"+i+"-inner"),xOffset=dims.w/2,yOffset=dims.h/4;x=pieCenterCopy.x+(pie.lineCoordGroups[i][0].x-pieCenterCopy.x)/1.8,y=pieCenterCopy.y+(pie.lineCoordGroups[i][0].y-pieCenterCopy.y)/1.8,x-=xOffset,y+=yOffset}return"translate("+x+","+y+")"}))},fadeInLabelsAndLines:function(pie){var loadSpeed="default"===pie.options.effects.load.effect?pie.options.effects.load.speed:1;setTimeout((function(){var labelFadeInTime="default"===pie.options.effects.load.effect?400:1;d3.selectAll("."+pie.cssPrefix+"labelGroup-outer").transition().duration(labelFadeInTime).style("opacity",(function(d,i){var percentage=pie.options.labels.outer.hideWhenLessThanPercentage;return null!==percentage&&d.percentage<percentage?0:1})),d3.selectAll("."+pie.cssPrefix+"labelGroup-inner").transition().duration(labelFadeInTime).style("opacity",(function(d,i){var percentage=pie.options.labels.inner.hideWhenLessThanPercentage;return null!==percentage&&d.percentage<percentage?0:1})),d3.selectAll("g."+pie.cssPrefix+"lineGroups").transition().duration(labelFadeInTime).style("opacity",1),helpers.isFunction(pie.options.callbacks.onload)&&setTimeout((function(){try{pie.options.callbacks.onload()}catch(e){}}),labelFadeInTime)}),loadSpeed)},getIncludes:function(val){var addMainLabel=!1,addValue=!1,addPercentage=!1;switch(val){case"label":addMainLabel=!0;break;case"value":addValue=!0;break;case"percentage":addPercentage=!0;break;case"label-value1":case"label-value2":addMainLabel=!0,addValue=!0;break;case"label-percentage1":case"label-percentage2":addMainLabel=!0,addPercentage=!0}return{mainLabel:addMainLabel,value:addValue,percentage:addPercentage}},computeOuterLabelCoords:function(pie){pie.svg.selectAll("."+pie.cssPrefix+"labelGroup-outer").each((function(d,i){return labels.getIdealOuterLabelPositions(pie,i)})),labels.resolveOuterLabelCollisions(pie)},resolveOuterLabelCollisions:function(pie){if("none"!==pie.options.labels.outer.format){var size=pie.options.data.content.length;labels.checkConflict(pie,0,"clockwise",size),labels.checkConflict(pie,size-1,"anticlockwise",size)}},checkConflict:function(pie,currIndex,direction,size){var i,curr;if(!(size<=1)){var currIndexHemisphere=pie.outerLabelGroupData[currIndex].hs;if(!("clockwise"===direction&&"right"!==currIndexHemisphere||"anticlockwise"===direction&&"left"!==currIndexHemisphere)){var nextIndex="clockwise"===direction?currIndex+1:currIndex-1,currLabelGroup=pie.outerLabelGroupData[currIndex],examinedLabelGroup=pie.outerLabelGroupData[nextIndex],info={labelHeights:pie.outerLabelGroupData[0].h,center:pie.pieCenter,lineLength:pie.outerRadius+pie.options.labels.outer.pieDistance,heightChange:pie.outerLabelGroupData[0].h+1};if("clockwise"===direction){for(i=0;i<=currIndex;i++)if(curr=pie.outerLabelGroupData[i],!labels.isLabelHidden(pie,i)&&helpers.rectIntersect(curr,examinedLabelGroup)){labels.adjustLabelPos(pie,nextIndex,currLabelGroup,info);break}}else for(i=size-1;i>=currIndex;i--)if(curr=pie.outerLabelGroupData[i],!labels.isLabelHidden(pie,i)&&helpers.rectIntersect(curr,examinedLabelGroup)){labels.adjustLabelPos(pie,nextIndex,currLabelGroup,info);break}labels.checkConflict(pie,nextIndex,direction,size)}}},isLabelHidden:function(pie,index){var percentage=pie.options.labels.outer.hideWhenLessThanPercentage;return null!==percentage&&d.percentage<percentage||""===pie.options.data.content[index].label},adjustLabelPos:function(pie,nextIndex,lastCorrectlyPositionedLabel,info){var xDiff,yDiff,newXPos,newYPos;newYPos=lastCorrectlyPositionedLabel.y+info.heightChange,yDiff=info.center.y-newYPos,xDiff=Math.abs(info.lineLength)>Math.abs(yDiff)?Math.sqrt(info.lineLength*info.lineLength-yDiff*yDiff):Math.sqrt(yDiff*yDiff-info.lineLength*info.lineLength),newXPos="right"===lastCorrectlyPositionedLabel.hs?info.center.x+xDiff:info.center.x-xDiff-pie.outerLabelGroupData[nextIndex].w,pie.outerLabelGroupData[nextIndex].x=newXPos,pie.outerLabelGroupData[nextIndex].y=newYPos},getIdealOuterLabelPositions:function(pie,i){var labelGroupNode=d3.select("#"+pie.cssPrefix+"labelGroup"+i+"-outer").node();if(labelGroupNode){var labelGroupDims=labelGroupNode.getBBox(),angle=segments.getSegmentAngle(i,pie.options.data.content,pie.totalSize,{midpoint:!0}),originalX=pie.pieCenter.x,originalY=pie.pieCenter.y-(pie.outerRadius+pie.options.labels.outer.pieDistance),newCoords=math.rotate(originalX,originalY,pie.pieCenter.x,pie.pieCenter.y,angle),hemisphere="right";angle>180?(newCoords.x-=labelGroupDims.width+8,hemisphere="left"):newCoords.x+=8,pie.outerLabelGroupData[i]={x:newCoords.x,y:newCoords.y,w:labelGroupDims.width,h:labelGroupDims.height,hs:hemisphere}}}},segments={effectMap:{none:d3.easeLinear,bounce:d3.easeBounce,linear:d3.easeLinear,sin:d3.easeSin,elastic:d3.easeElastic,back:d3.easeBack,quad:d3.easeQuad,circle:d3.easeCircle,exp:d3.easeExp},create:function(pie){var pieCenter=pie.pieCenter,colors=pie.options.colors,loadEffects=pie.options.effects.load,segmentStroke=pie.options.misc.colors.segmentStroke,pieChartElement=pie.svg.insert("g","#"+pie.cssPrefix+"title").attr("transform",(function(){return math.getPieTranslateCenter(pieCenter)})).attr("class",pie.cssPrefix+"pieChart"),arc=d3.arc().innerRadius(pie.innerRadius).outerRadius(pie.outerRadius).startAngle(0).endAngle((function(d){return d.value/pie.totalSize*2*Math.PI})),g=pieChartElement.selectAll("."+pie.cssPrefix+"arc").data(pie.options.data.content).enter().append("g").attr("class",pie.cssPrefix+"arc"),loadSpeed=loadEffects.speed;"none"===loadEffects.effect&&(loadSpeed=0),g.append("path").attr("id",(function(d,i){return pie.cssPrefix+"segment"+i})).attr("fill",(function(d,i){var color=colors[i];return pie.options.misc.gradient.enabled&&(color="url(#"+pie.cssPrefix+"grad"+i+")"),color})).style("stroke",segmentStroke).style("stroke-width",1).transition().ease(d3.easeCubicInOut).duration(loadSpeed).attr("data-index",(function(d,i){return i})).attrTween("d",(function(b){var i=d3.interpolate({value:0},b);return function(t){return pie.arc(i(t))}})),pie.svg.selectAll("g."+pie.cssPrefix+"arc").attr("transform",(function(d,i){var angle=0;return i>0&&(angle=segments.getSegmentAngle(i-1,pie.options.data.content,pie.totalSize)),"rotate("+angle+")"})),pie.arc=arc},addGradients:function(pie){var grads=pie.svg.append("defs").selectAll("radialGradient").data(pie.options.data.content).enter().append("radialGradient").attr("gradientUnits","userSpaceOnUse").attr("cx",0).attr("cy",0).attr("r","120%").attr("id",(function(d,i){return pie.cssPrefix+"grad"+i}));grads.append("stop").attr("offset","0%").style("stop-color",(function(d,i){return pie.options.colors[i]})),grads.append("stop").attr("offset",pie.options.misc.gradient.percentage+"%").style("stop-color",pie.options.misc.gradient.color)},addSegmentEventHandlers:function(pie){var arc=d3.selectAll("."+pie.cssPrefix+"arc,."+pie.cssPrefix+"labelGroup-inner,."+pie.cssPrefix+"labelGroup-outer");arc.on("click",(function(){var currentEl=d3.select(this),segment;if(currentEl.attr("class")===pie.cssPrefix+"arc")segment=currentEl.select("path");else{var index=currentEl.attr("data-index");segment=d3.select("#"+pie.cssPrefix+"segment"+index)}var isExpanded=segment.attr("class")===pie.cssPrefix+"expanded";segments.onSegmentEvent(pie,pie.options.callbacks.onClickSegment,segment,isExpanded),"none"!==pie.options.effects.pullOutSegmentOnClick.effect&&(isExpanded?segments.closeSegment(pie,segment.node()):segments.openSegment(pie,segment.node()))})),arc.on("mouseover",(function(){var currentEl=d3.select(this),segment,index;if(currentEl.attr("class")===pie.cssPrefix+"arc"?segment=currentEl.select("path"):(index=currentEl.attr("data-index"),segment=d3.select("#"+pie.cssPrefix+"segment"+index)),pie.options.effects.highlightSegmentOnMouseover){index=segment.attr("data-index");var segColor=pie.options.colors[index];segment.style("fill",helpers.getColorShade(segColor,pie.options.effects.highlightLuminosity))}pie.options.tooltips.enabled&&(index=segment.attr("data-index"),tt.showTooltip(pie,index));var isExpanded=segment.attr("class")===pie.cssPrefix+"expanded";segments.onSegmentEvent(pie,pie.options.callbacks.onMouseoverSegment,segment,isExpanded)})),arc.on("mousemove",(function(){tt.moveTooltip(pie)})),arc.on("mouseout",(function(){var currentEl=d3.select(this),segment,index;if(currentEl.attr("class")===pie.cssPrefix+"arc"?segment=currentEl.select("path"):(index=currentEl.attr("data-index"),segment=d3.select("#"+pie.cssPrefix+"segment"+index)),pie.options.effects.highlightSegmentOnMouseover){index=segment.attr("data-index");var color=pie.options.colors[index];pie.options.misc.gradient.enabled&&(color="url(#"+pie.cssPrefix+"grad"+index+")"),segment.style("fill",color)}pie.options.tooltips.enabled&&(index=segment.attr("data-index"),tt.hideTooltip(pie,index));var isExpanded=segment.attr("class")===pie.cssPrefix+"expanded";segments.onSegmentEvent(pie,pie.options.callbacks.onMouseoutSegment,segment,isExpanded)}))},onSegmentEvent:function(pie,func,segment,isExpanded){if(helpers.isFunction(func)){var index=parseInt(segment.attr("data-index"),10);func({segment:segment.node(),index:index,expanded:isExpanded,data:pie.options.data.content[index]})}},openSegment:function(pie,segment){pie.isOpeningSegment||(pie.isOpeningSegment=!0,segments.maybeCloseOpenSegment(),d3.select(segment).transition().ease(segments.effectMap[pie.options.effects.pullOutSegmentOnClick.effect]).duration(pie.options.effects.pullOutSegmentOnClick.speed).attr("transform",(function(d,i){var c=pie.arc.centroid(d),x=c[0],y=c[1],h=Math.sqrt(x*x+y*y),pullOutSize=parseInt(pie.options.effects.pullOutSegmentOnClick.size,10);return"translate("+x/h*pullOutSize+","+y/h*pullOutSize+")"})).on("end",(function(d,i){pie.currentlyOpenSegment=segment,pie.isOpeningSegment=!1,d3.select(segment).attr("class",pie.cssPrefix+"expanded")})))},maybeCloseOpenSegment:function(){d3.selectAll("."+pie.cssPrefix+"expanded").size()>0&&segments.closeSegment(pie,d3.select("."+pie.cssPrefix+"expanded").node())},closeSegment:function(pie,segment){d3.select(segment).transition().duration(400).attr("transform","translate(0,0)").on("end",(function(d,i){d3.select(segment).attr("class",""),pie.currentlyOpenSegment=null}))},getCentroid:function(el){var bbox=el.getBBox();return{x:bbox.x+bbox.width/2,y:bbox.y+bbox.height/2}},getSegmentAngle:function(index,data,totalSize,opts){var options=extend({compounded:!0,midpoint:!1},opts),currValue=data[index].value,fullValue;if(options.compounded){fullValue=0;for(var i=0;i<=index;i++)fullValue+=data[i].value}void 0===fullValue&&(fullValue=currValue);var angle=fullValue/totalSize*360,currAngle;options.midpoint&&(angle-=currValue/totalSize*360/2);return angle}},text={offscreenCoord:-1e4,addTitle:function(pie){var title=pie.svg.selectAll("."+pie.cssPrefix+"title").data([pie.options.header.title]).enter().append("text").text((function(d){return d.text})).attr("id",pie.cssPrefix+"title").attr("class",pie.cssPrefix+"title").attr("x",text.offscreenCoord).attr("y",text.offscreenCoord).attr("text-anchor",(function(){var location;return location="top-center"===pie.options.header.location||"pie-center"===pie.options.header.location?"middle":"left"})).attr("fill",(function(d){return d.color})).style("font-size",(function(d){return d.fontSize+"px"})).style("font-family",(function(d){return d.font}))},positionTitle:function(pie){var textComponents=pie.textComponents,headerLocation=pie.options.header.location,canvasPadding=pie.options.misc.canvasPadding,canvasWidth=pie.options.size.canvasWidth,titleSubtitlePadding=pie.options.header.titleSubtitlePadding,x;x="top-left"===headerLocation?canvasPadding.left:(canvasWidth-canvasPadding.right)/2+canvasPadding.left,x+=pie.options.misc.pieCenterOffset.x;var y=canvasPadding.top+textComponents.title.h,totalTitleHeight;"pie-center"===headerLocation&&(y=pie.pieCenter.y,textComponents.subtitle.exists?y=y-(textComponents.title.h+titleSubtitlePadding+textComponents.subtitle.h)/2+textComponents.title.h:y+=textComponents.title.h/4);pie.svg.select("#"+pie.cssPrefix+"title").attr("x",x).attr("y",y)},addSubtitle:function(pie){var headerLocation=pie.options.header.location;pie.svg.selectAll("."+pie.cssPrefix+"subtitle").data([pie.options.header.subtitle]).enter().append("text").text((function(d){return d.text})).attr("x",text.offscreenCoord).attr("y",text.offscreenCoord).attr("id",pie.cssPrefix+"subtitle").attr("class",pie.cssPrefix+"subtitle").attr("text-anchor",(function(){var location;return location="top-center"===headerLocation||"pie-center"===headerLocation?"middle":"left"})).attr("fill",(function(d){return d.color})).style("font-size",(function(d){return d.fontSize+"px"})).style("font-family",(function(d){return d.font}))},positionSubtitle:function(pie){var canvasPadding=pie.options.misc.canvasPadding,canvasWidth=pie.options.size.canvasWidth,x;x="top-left"===pie.options.header.location?canvasPadding.left:(canvasWidth-canvasPadding.right)/2+canvasPadding.left,x+=pie.options.misc.pieCenterOffset.x;var y=text.getHeaderHeight(pie);pie.svg.select("#"+pie.cssPrefix+"subtitle").attr("x",x).attr("y",y)},addFooter:function(pie){pie.svg.selectAll("."+pie.cssPrefix+"footer").data([pie.options.footer]).enter().append("text").text((function(d){return d.text})).attr("x",text.offscreenCoord).attr("y",text.offscreenCoord).attr("id",pie.cssPrefix+"footer").attr("class",pie.cssPrefix+"footer").attr("text-anchor",(function(){var location="left";return"bottom-center"===pie.options.footer.location?location="middle":"bottom-right"===pie.options.footer.location&&(location="left"),location})).attr("fill",(function(d){return d.color})).style("font-size",(function(d){return d.fontSize+"px"})).style("font-family",(function(d){return d.font}))},positionFooter:function(pie){var footerLocation=pie.options.footer.location,footerWidth=pie.textComponents.footer.w,canvasWidth=pie.options.size.canvasWidth,canvasHeight=pie.options.size.canvasHeight,canvasPadding=pie.options.misc.canvasPadding,x;x="bottom-left"===footerLocation?canvasPadding.left:"bottom-right"===footerLocation?canvasWidth-footerWidth-canvasPadding.right:canvasWidth/2,pie.svg.select("#"+pie.cssPrefix+"footer").attr("x",x).attr("y",canvasHeight-canvasPadding.bottom)},getHeaderHeight:function(pie){var h;if(pie.textComponents.title.exists){var totalTitleHeight=pie.textComponents.title.h+pie.options.header.titleSubtitlePadding+pie.textComponents.subtitle.h;h="pie-center"===pie.options.header.location?pie.pieCenter.y-totalTitleHeight/2+totalTitleHeight:totalTitleHeight+pie.options.misc.canvasPadding.top}else if("pie-center"===pie.options.header.location){var footerPlusPadding=pie.options.misc.canvasPadding.bottom+pie.textComponents.footer.h;h=(pie.options.size.canvasHeight-footerPlusPadding)/2+pie.options.misc.canvasPadding.top+pie.textComponents.subtitle.h/2}else h=pie.options.misc.canvasPadding.top+pie.textComponents.subtitle.h;return h}},tt={addTooltips:function(pie){var tooltips=pie.svg.insert("g").attr("class",pie.cssPrefix+"tooltips");tooltips.selectAll("."+pie.cssPrefix+"tooltip").data(pie.options.data.content).enter().append("g").attr("class",pie.cssPrefix+"tooltip").attr("id",(function(d,i){return pie.cssPrefix+"tooltip"+i})).style("opacity",0).append("rect").attr("rx",pie.options.tooltips.styles.borderRadius).attr("ry",pie.options.tooltips.styles.borderRadius).attr("x",-pie.options.tooltips.styles.padding).attr("opacity",pie.options.tooltips.styles.backgroundOpacity).style("fill",pie.options.tooltips.styles.backgroundColor),tooltips.selectAll("."+pie.cssPrefix+"tooltip").data(pie.options.data.content).append("text").attr("fill",(function(d){return pie.options.tooltips.styles.color})).style("font-size",(function(d){return pie.options.tooltips.styles.fontSize})).style("font-family",(function(d){return pie.options.tooltips.styles.font})).text((function(d,i){var caption=pie.options.tooltips.string;return"caption"===pie.options.tooltips.type&&(caption=d.caption),tt.replacePlaceholders(pie,caption,i,{label:d.label,value:d.value,percentage:d.percentage})})),tooltips.selectAll("."+pie.cssPrefix+"tooltip rect").attr("width",(function(d,i){var dims;return helpers.getDimensions(pie.cssPrefix+"tooltip"+i).w+2*pie.options.tooltips.styles.padding})).attr("height",(function(d,i){var dims;return helpers.getDimensions(pie.cssPrefix+"tooltip"+i).h+2*pie.options.tooltips.styles.padding})).attr("y",(function(d,i){var dims;return-helpers.getDimensions(pie.cssPrefix+"tooltip"+i).h/2+1}))},showTooltip:function(pie,index){var fadeInSpeed=pie.options.tooltips.styles.fadeInSpeed;tt.currentTooltip===index&&(fadeInSpeed=1),tt.currentTooltip=index,d3.select("#"+pie.cssPrefix+"tooltip"+index).transition().duration(fadeInSpeed).style("opacity",(function(){return 1})),tt.moveTooltip(pie)},moveTooltip:function(pie){d3.selectAll("#"+pie.cssPrefix+"tooltip"+tt.currentTooltip).attr("transform",(function(d){var mouseCoords=d3.mouse(this.parentNode),x,y;return"translate("+(mouseCoords[0]+pie.options.tooltips.styles.padding+2)+","+(mouseCoords[1]-2*pie.options.tooltips.styles.padding-2)+")"}))},hideTooltip:function(pie,index){d3.select("#"+pie.cssPrefix+"tooltip"+index).style("opacity",(function(){return 0})),d3.select("#"+pie.cssPrefix+"tooltip"+tt.currentTooltip).attr("transform",(function(d,i){var x,y;return"translate("+(pie.options.size.canvasWidth+1e3)+","+(pie.options.size.canvasHeight+1e3)+")"}))},replacePlaceholders:function(pie,str,index,replacements){helpers.isFunction(pie.options.tooltips.placeholderParser)&&pie.options.tooltips.placeholderParser(index,replacements);var replacer=function(){return function(match){var placeholder=arguments[1];return replacements.hasOwnProperty(placeholder)?replacements[arguments[1]]:arguments[0]}};return str.replace(/\{(\w+)\}/g,replacer(replacements))}},d3pie=function(element,options){if(this.element=element,"string"==typeof element){var el=element.replace(/^#/,"");this.element=document.getElementById(el)}var opts={};extend(!0,opts,defaultSettings,options),this.options=opts,null!==this.options.misc.cssPrefix?this.cssPrefix=this.options.misc.cssPrefix:(this.cssPrefix="p"+_uniqueIDCounter+"_",_uniqueIDCounter++),validate_initialCheck(this)&&(d3.select(this.element).attr("d3pie","0.2.1"),_setupData.call(this),_init.call(this))};d3pie.prototype.recreate=function(){validate_initialCheck(this)&&(_setupData.call(this),_init.call(this))},d3pie.prototype.redraw=function(){this.element.innerHTML="",_init.call(this)},d3pie.prototype.destroy=function(){this.element.innerHTML="",d3.select(this.element).attr("d3pie",null)},d3pie.prototype.getOpenSegment=function(){var segment=this.currentlyOpenSegment;if(null!=segment){var index=parseInt(d3.select(segment).attr("data-index"),10);return{element:segment,index:index,data:this.options.data.content[index]}}return null},d3pie.prototype.openSegment=function(index){(index=parseInt(index,10))<0||index>this.options.data.content.length-1||segments.openSegment(this,d3.select("#"+this.cssPrefix+"segment"+index).node())},d3pie.prototype.closeSegment=function(){segments.maybeCloseOpenSegment()},d3pie.prototype.updateProp=function(propKey,value){switch(propKey){case"header.title.text":var oldVal=helpers.processObj(this.options,propKey);helpers.processObj(this.options,propKey,value),d3.select("#"+this.cssPrefix+"title").html(value),(""===oldVal&&""!==value||""!==oldVal&&""===value)&&this.redraw();break;case"header.subtitle.text":var oldValue=helpers.processObj(this.options,propKey);helpers.processObj(this.options,propKey,value),d3.select("#"+this.cssPrefix+"subtitle").html(value),(""===oldValue&&""!==value||""!==oldValue&&""===value)&&this.redraw();break;case"callbacks.onload":case"callbacks.onMouseoverSegment":case"callbacks.onMouseoutSegment":case"callbacks.onClickSegment":case"effects.pullOutSegmentOnClick.effect":case"effects.pullOutSegmentOnClick.speed":case"effects.pullOutSegmentOnClick.size":case"effects.highlightSegmentOnMouseover":case"effects.highlightLuminosity":helpers.processObj(this.options,propKey,value);break;default:helpers.processObj(this.options,propKey,value),this.destroy(),this.recreate()}};var _setupData=function(){this.options.data.content=math.sortPieData(this),this.options.data.smallSegmentGrouping.enabled&&(this.options.data.content=helpers.applySmallSegmentGrouping(this.options.data.content,this.options.data.smallSegmentGrouping)),this.options.colors=helpers.initSegmentColors(this),this.totalSize=math.getTotalPieSize(this.options.data.content);for(var dp=this.options.labels.percentage.decimalPlaces,i=0;i<this.options.data.content.length;i++)this.options.data.content[i].percentage=_getPercentage(this.options.data.content[i].value,this.totalSize,dp);for(var totalPercentage=0,j=0;j<this.options.data.content.length;j++)j===this.options.data.content.length-1&&(this.options.data.content[j].percentage=(100-totalPercentage).toFixed(dp)),totalPercentage+=parseFloat(this.options.data.content[j].percentage)},_init=function(){this.svg=helpers.addSVGSpace(this),this.textComponents={headerHeight:0,title:{exists:""!==this.options.header.title.text,h:0,w:0},subtitle:{exists:""!==this.options.header.subtitle.text,h:0,w:0},footer:{exists:""!==this.options.footer.text,h:0,w:0}},this.outerLabelGroupData=[],this.textComponents.title.exists&&text.addTitle(this),this.textComponents.subtitle.exists&&text.addSubtitle(this),text.addFooter(this);var self=this;helpers.whenIdExists(this.cssPrefix+"footer",(function(){text.positionFooter(self);var d3=helpers.getDimensions(self.cssPrefix+"footer");self.textComponents.footer.h=d3.h,self.textComponents.footer.w=d3.w}));var reqEls=[];this.textComponents.title.exists&&reqEls.push(this.cssPrefix+"title"),this.textComponents.subtitle.exists&&reqEls.push(this.cssPrefix+"subtitle"),this.textComponents.footer.exists&&reqEls.push(this.cssPrefix+"footer"),helpers.whenElementsExist(reqEls,(function(){if(self.textComponents.title.exists){var d1=helpers.getDimensions(self.cssPrefix+"title");self.textComponents.title.h=d1.h,self.textComponents.title.w=d1.w}if(self.textComponents.subtitle.exists){var d2=helpers.getDimensions(self.cssPrefix+"subtitle");self.textComponents.subtitle.h=d2.h,self.textComponents.subtitle.w=d2.w}if(self.textComponents.title.exists||self.textComponents.subtitle.exists){var headerHeight=0;self.textComponents.title.exists&&(headerHeight+=self.textComponents.title.h,self.textComponents.subtitle.exists&&(headerHeight+=self.options.header.titleSubtitlePadding)),self.textComponents.subtitle.exists&&(headerHeight+=self.textComponents.subtitle.h),self.textComponents.headerHeight=headerHeight}math.computePieRadius(self),math.calculatePieCenter(self),text.positionTitle(self),text.positionSubtitle(self),self.options.misc.gradient.enabled&&segments.addGradients(self),segments.create(self),labels.add(self,"inner",self.options.labels.inner.format),labels.add(self,"outer",self.options.labels.outer.format),labels.positionLabelElements(self,"inner",self.options.labels.inner.format),labels.positionLabelElements(self,"outer",self.options.labels.outer.format),labels.computeOuterLabelCoords(self),labels.positionLabelGroups(self,"outer"),labels.computeLabelLinePositions(self),self.options.labels.lines.enabled&&"none"!==self.options.labels.outer.format&&labels.addLabelLines(self),labels.positionLabelGroups(self,"inner"),labels.fadeInLabelsAndLines(self),self.options.tooltips.enabled&&tt.addTooltips(self),segments.addSegmentEventHandlers(self)}))},_getPercentage=function(value,total,decimalPlaces){var relativeAmount=value/total;return decimalPlaces<=0?Math.round(100*relativeAmount):(100*relativeAmount).toFixed(decimalPlaces)};return d3pie}));